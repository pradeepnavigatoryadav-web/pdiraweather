/*
This is a ready-to-use template for a Weather Routing Website
using MarigeoRoute, Windy, and OpenCPN Weather Routing Plugin.
*/

// ===================== server.js =====================
const express = require('express');
const { exec } = require('child_process');
const path = require('path');
const app = express();
const PORT = process.env.PORT || 3000;

app.use(express.json());
app.use(express.static(path.join(__dirname, 'public')));

// Route to get weather routing from Python MarigeoRoute script
app.post('/route', (req, res) => {
    const { start, end } = req.body;
    exec(`python weatherRouting.py ${start} ${end}`, (err, stdout, stderr) => {
        if (err) return res.status(500).send(err.message);
        res.send(JSON.parse(stdout));
    });
});

app.listen(PORT, () => console.log(`Server running on http://localhost:${PORT}`));


// ===================== weatherRouting.py =====================
# Place this file in the root folder of the project
import sys
import json

def weather_routing(start, end):
    # Placeholder logic for MarigeoRoute
    return {"route": f"Route from {start} to {end} calculated"}

if __name__ == "__main__":
    start = sys.argv[1]
    end = sys.argv[2]
    result = weather_routing(start, end)
    print(json.dumps(result))


// ===================== public/index.html =====================
<!DOCTYPE html>
<html>
<head>
    <title>Weather Routing Website</title>
    <script src="https://api.windy.com/assets/map-forecast/libBoot.js"></script>
</head>
<body>
    <h1>Weather Routing Website</h1>
    <input id="start" placeholder="Start coordinates">
    <input id="end" placeholder="End coordinates">
    <button onclick="getRoute()">Calculate Route</button>
    <pre id="result"></pre>

    <div id="windy" style="width: 800px; height: 600px;"></div>

    <script>
        const options = {
            key: 'YOUR_WINDY_API_KEY', // Insert your Windy API key
            lat: 50.5,
            lon: 14.5,
            zoom: 5
        };
        const windy = new Windy(options);

        async function getRoute() {
            const start = document.getElementById('start').value;
            const end = document.getElementById('end').value;
            const response = await fetch('/route', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({start, end})
            });
            const data = await response.json();
            document.getElementById('result').textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html>
